<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroFit - Corps & Esprit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=DM+Sans:wght@400;500;700&display=swap');
        
        body {
            font-family: 'DM Sans', sans-serif;
        }
        
        h1, h2, h3, .title-font {
            font-family: 'Fredoka', sans-serif;
        }
        
        .house-container {
            perspective: 1000px;
            position: relative;
        }
        
        .room {
            background: linear-gradient(135deg, #f5e6d3 0%, #d4c5b0 100%);
            border: 4px solid #8b7355;
            position: relative;
            overflow: hidden;
        }
        
        .room::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                repeating-linear-gradient(90deg, transparent, transparent 49px, rgba(139, 115, 85, 0.1) 49px, rgba(139, 115, 85, 0.1) 50px),
                repeating-linear-gradient(0deg, transparent, transparent 49px, rgba(139, 115, 85, 0.1) 49px, rgba(139, 115, 85, 0.1) 50px);
            pointer-events: none;
        }
        
        .furniture-item {
            position: absolute;
            cursor: move;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            user-select: none;
            z-index: 10;
        }
        
        .furniture-item:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }
        
        .furniture-item.dragging {
            opacity: 0.7;
            z-index: 1000;
        }
        
        .wall {
            position: absolute;
            background: linear-gradient(180deg, #b8a890 0%, #a39780 100%);
        }
        
        .wall-top {
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            border-bottom: 3px solid #8b7355;
        }
        
        .wall-left {
            top: 0;
            left: 0;
            width: 40px;
            bottom: 0;
            border-right: 3px solid #8b7355;
        }
        
        .wall-right {
            top: 0;
            right: 0;
            width: 40px;
            bottom: 0;
            border-left: 3px solid #8b7355;
        }
        
        .wall-bottom {
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            border-top: 3px solid #8b7355;
        }
        
        .window {
            position: absolute;
            background: linear-gradient(135deg, #87ceeb 0%, #4a9fd8 100%);
            border: 4px solid #654321;
            border-radius: 4px;
            box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.3);
        }
        
        .door {
            position: absolute;
            background: linear-gradient(180deg, #8b4513 0%, #654321 100%);
            border: 3px solid #4a2511;
            border-radius: 4px;
        }
        
        .door-handle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ffd700;
            border-radius: 50%;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .shop-item {
            transition: all 0.3s ease;
        }
        
        .shop-item:hover {
            transform: scale(1.05);
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background-color: #cbd5e0;
            border-radius: 26px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .toggle-switch.active {
            background-color: #6366f1;
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-blue-50 to-pink-50 min-h-screen">
    <div id="app"></div>

    <script>
        const GAMES_DATABASE = {
            memory: [
                {
                    key: 'memory_emojis',
                    titre: 'Memory √âmojis',
                    cards: ['üéÆ', 'üé®', 'üé≠', 'üé™', 'üéØ', 'üé≤', 'üé∏', 'üé∫'],
                    difficulty: 'facile'
                },
                {
                    key: 'memory_animals',
                    titre: 'Memory Animaux',
                    cards: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'ü¶ä', 'üêª', 'üêº', 'üê®'],
                    difficulty: 'facile'
                },
                {
                    key: 'memory_food',
                    titre: 'Memory Cuisine',
                    cards: ['üçï', 'üçî', 'üçü', 'üåÆ', 'üç£', 'üçú', 'üç∞', 'üç™'],
                    difficulty: 'facile'
                },
                {
                    key: 'memory_nature',
                    titre: 'Memory Nature',
                    cards: ['üå∏', 'üå∫', 'üåª', 'üå∑', 'üåπ', 'üçÄ', 'üåø', 'üåæ'],
                    difficulty: 'facile'
                },
                {
                    key: 'memory_sports',
                    titre: 'Memory Sports',
                    cards: ['‚öΩ', 'üèÄ', 'üéæ', '‚öæ', 'üèê', 'üèà', 'üé±', 'üèì'],
                    difficulty: 'moyen'
                }
            ],
            math: [
                {
                    key: 'math_addition',
                    titre: 'Additions Rapides',
                    operator: '+',
                    maxNumber: 20,
                    difficulty: 'facile'
                },
                {
                    key: 'math_subtraction',
                    titre: 'Soustractions Rapides',
                    operator: '-',
                    maxNumber: 20,
                    difficulty: 'facile'
                },
                {
                    key: 'math_multiplication',
                    titre: 'Tables de multiplication',
                    operator: '√ó',
                    maxNumber: 12,
                    difficulty: 'moyen'
                },
                {
                    key: 'math_mixed',
                    titre: 'Calcul Mental Mixte',
                    operator: 'mixed',
                    maxNumber: 30,
                    difficulty: 'difficile'
                }
            ],
            puzzle: [
                {
                    key: 'puzzle_sequence',
                    titre: 'S√©quence de Chiffres',
                    type: 'sequence',
                    difficulty: 'moyen'
                },
                {
                    key: 'puzzle_pattern',
                    titre: 'Motifs Logiques',
                    type: 'pattern',
                    difficulty: 'moyen'
                },
                {
                    key: 'puzzle_word',
                    titre: 'Anagrammes',
                    type: 'anagram',
                    difficulty: 'moyen'
                }
            ],
            reflex: [
                {
                    key: 'reflex_click',
                    titre: 'Test de R√©flexes',
                    type: 'click',
                    difficulty: 'facile'
                },
                {
                    key: 'reflex_color',
                    titre: 'Couleurs Rapides',
                    type: 'color',
                    difficulty: 'moyen'
                }
            ],
            stretch: [
                {
                    key: 'stretch_neck',
                    titre: '√âtirement du cou',
                    instructions: [
                        'Penchez doucement la t√™te vers la droite',
                        'Maintenez 15 secondes',
                        'R√©p√©tez de l\'autre c√¥t√©',
                        'Respirez profond√©ment'
                    ]
                },
                {
                    key: 'stretch_shoulders',
                    titre: '√âtirement des √©paules',
                    instructions: [
                        'Levez les bras au-dessus de la t√™te',
                        'Entrelacez les doigts',
                        '√âtirez-vous vers le haut',
                        'Maintenez 20 secondes'
                    ]
                },
                {
                    key: 'stretch_back',
                    titre: '√âtirement du dos',
                    instructions: [
                        'Asseyez-vous bien droit',
                        'Tournez le torse vers la droite',
                        'Maintenez 15 secondes',
                        'R√©p√©tez de l\'autre c√¥t√©'
                    ]
                },
                {
                    key: 'stretch_wrists',
                    titre: '√âtirement des poignets',
                    instructions: [
                        'Tendez le bras devant vous',
                        'Tirez doucement les doigts vers vous',
                        'Maintenez 10 secondes',
                        'Changez de main'
                    ]
                },
                {
                    key: 'stretch_legs',
                    titre: '√âtirement des jambes',
                    instructions: [
                        'Levez-vous et √©cartez les pieds',
                        'Penchez-vous lentement vers l\'avant',
                        'Essayez de toucher vos orteils',
                        'Maintenez 20 secondes'
                    ]
                }
            ]
        };

        const HOUSE_ITEMS = {
            furniture: [
                { id: 'sofa_basic', name: 'Canap√© Simple', icon: 'üõãÔ∏è', cost: 100, width: 120, height: 80, category: 'furniture' },
                { id: 'sofa_luxury', name: 'Canap√© de Luxe', icon: 'üõãÔ∏è‚ú®', cost: 300, width: 140, height: 90, category: 'furniture' },
                { id: 'bed_simple', name: 'Lit Simple', icon: 'üõèÔ∏è', cost: 150, width: 100, height: 120, category: 'furniture' },
                { id: 'bed_king', name: 'Lit King Size', icon: 'üõèÔ∏èüëë', cost: 400, width: 140, height: 140, category: 'furniture' },
                { id: 'chair', name: 'Chaise', icon: 'ü™ë', cost: 50, width: 60, height: 60, category: 'furniture' },
                { id: 'table', name: 'Table', icon: 'ü™ëü™ë', cost: 120, width: 100, height: 100, category: 'furniture' },
                { id: 'desk', name: 'Bureau', icon: 'üñ•Ô∏è', cost: 200, width: 110, height: 80, category: 'furniture' }
            ],
            decoration: [
                { id: 'plant_small', name: 'Petite Plante', icon: 'ü™¥', cost: 30, width: 50, height: 50, category: 'decoration' },
                { id: 'plant_large', name: 'Grande Plante', icon: 'üå¥', cost: 80, width: 60, height: 80, category: 'decoration' },
                { id: 'painting', name: 'Tableau', icon: 'üñºÔ∏è', cost: 100, width: 80, height: 60, category: 'decoration' },
                { id: 'lamp', name: 'Lampe', icon: 'üí°', cost: 60, width: 50, height: 50, category: 'decoration' },
                { id: 'rug', name: 'Tapis', icon: 'üü´', cost: 90, width: 120, height: 80, category: 'decoration' },
                { id: 'mirror', name: 'Miroir', icon: 'ü™û', cost: 110, width: 60, height: 80, category: 'decoration' },
                { id: 'curtains', name: 'Rideaux', icon: 'ü™ü', cost: 70, width: 80, height: 60, category: 'decoration' }
            ],
            tech: [
                { id: 'tv', name: 'T√©l√©vision', icon: 'üì∫', cost: 250, width: 100, height: 70, category: 'tech' },
                { id: 'computer', name: 'Ordinateur', icon: 'üíª', cost: 350, width: 80, height: 60, category: 'tech' },
                { id: 'console', name: 'Console de jeu', icon: 'üéÆ', cost: 300, width: 70, height: 50, category: 'tech' },
                { id: 'speaker', name: 'Enceinte', icon: 'üîä', cost: 150, width: 60, height: 60, category: 'tech' },
                { id: 'camera', name: 'Cam√©ra', icon: 'üì∑', cost: 200, width: 50, height: 50, category: 'tech' }
            ],
            luxury: [
                { id: 'chandelier', name: 'Lustre', icon: 'üíé', cost: 500, width: 80, height: 80, category: 'luxury' },
                { id: 'piano', name: 'Piano', icon: 'üéπ', cost: 800, width: 120, height: 100, category: 'luxury' },
                { id: 'aquarium', name: 'Aquarium', icon: 'üê†', cost: 400, width: 100, height: 80, category: 'luxury' },
                { id: 'fountain', name: 'Fontaine', icon: '‚õ≤', cost: 600, width: 90, height: 90, category: 'luxury' },
                { id: 'statue', name: 'Statue', icon: 'üóø', cost: 450, width: 70, height: 100, category: 'luxury' }
            ]
        };

        const App = {
            currentPage: 'welcome',
            userProfile: null,
            dailyProgram: null,
            currentExercise: null,
            completedToday: [],
            stats: { xp: 0, streak: 0, coins: 0 },
            isLoggedIn: false,
            currentUser: null,
            house: [],
            gameState: null,
            draggedItem: null,
            dragOffset: { x: 0, y: 0 },
            settings: { notifications: false, notificationTime: '09:00' },

            init() {
                this.loadSession();
                this.render();
            },

            async loadSession() {
                try {
                    const sessionData = localStorage.getItem('current_session');
                    if (sessionData) {
                        const data = JSON.parse(sessionData);
                        this.currentUser = data.email;
                        this.isLoggedIn = true;
                        await this.loadUserData(data.email);
                        this.currentPage = 'dashboard';
                        this.render();
                    }
                } catch (e) {
                    console.log('No session');
                }
            },

            async loadUserData(email) {
                try {
                    const key = `user_${email.replace(/[@.]/g, '_')}`;
                    const profileData = localStorage.getItem(`${key}_profile`);
                    const statsData = localStorage.getItem(`${key}_stats`);
                    const houseData = localStorage.getItem(`${key}_house`);
                    const settingsData = localStorage.getItem(`${key}_settings`);
                    const completedData = localStorage.getItem(`${key}_completed`);
                    const completionDate = localStorage.getItem(`${key}_completion_date`);
                    
                    if (profileData) {
                        this.userProfile = JSON.parse(profileData);
                        this.generateProgram(this.userProfile);
                    }
                    if (statsData) this.stats = JSON.parse(statsData);
                    if (houseData) this.house = JSON.parse(houseData);
                    if (settingsData) this.settings = JSON.parse(settingsData);
                    
                    // Charger les d√©fis compl√©t√©s
                    if (completedData) {
                        this.completedToday = JSON.parse(completedData);
                    }
                    
                    // V√©rifier si c'est un nouveau jour
                    const today = new Date().toDateString();
                    if (completionDate && completionDate !== today) {
                        // Nouveau jour, r√©initialiser les d√©fis compl√©t√©s
                        this.completedToday = [];
                        localStorage.removeItem(`${key}_completed`);
                    }
                } catch (e) {
                    console.error('Error loading user data:', e);
                }
            },

            async saveData() {
                if (!this.isLoggedIn || !this.currentUser) return;
                try {
                    const key = `user_${this.currentUser.replace(/[@.]/g, '_')}`;
                    localStorage.setItem(`${key}_profile`, JSON.stringify(this.userProfile));
                    localStorage.setItem(`${key}_stats`, JSON.stringify(this.stats));
                    localStorage.setItem(`${key}_house`, JSON.stringify(this.house));
                    localStorage.setItem(`${key}_settings`, JSON.stringify(this.settings));
                    localStorage.setItem(`${key}_completed`, JSON.stringify(this.completedToday));
                    
                    // Sauvegarder la date si tous les d√©fis sont termin√©s
                    if (this.dailyProgram && this.completedToday.length === this.dailyProgram.sequence.length) {
                        const today = new Date().toDateString();
                        localStorage.setItem(`${key}_completion_date`, today);
                    }
                } catch (e) {
                    console.error('Error saving data:', e);
                }
            },

            async logout() {
                localStorage.removeItem('current_session');
                this.isLoggedIn = false;
                this.currentUser = null;
                this.userProfile = null;
                this.currentPage = 'welcome';
                this.render();
            },

            generateProgram(profile) {
                const allExercises = [];
                
                // Memory games
                const memoryGames = GAMES_DATABASE.memory;
                const randomMemory = memoryGames[Math.floor(Math.random() * memoryGames.length)];
                allExercises.push({
                    type: 'memory',
                    titre: randomMemory.titre,
                    duree: 3,
                    icon: 'üéÆ',
                    gameData: randomMemory
                });

                // Math games
                const mathGames = GAMES_DATABASE.math;
                const randomMath = mathGames[Math.floor(Math.random() * mathGames.length)];
                allExercises.push({
                    type: 'math',
                    titre: randomMath.titre,
                    duree: 3,
                    icon: 'üß†',
                    gameData: randomMath
                });

                // Puzzle games
                const puzzleGames = GAMES_DATABASE.puzzle;
                const randomPuzzle = puzzleGames[Math.floor(Math.random() * puzzleGames.length)];
                allExercises.push({
                    type: 'puzzle',
                    titre: randomPuzzle.titre,
                    duree: 4,
                    icon: 'üß©',
                    gameData: randomPuzzle
                });

                // Reflex games
                const reflexGames = GAMES_DATABASE.reflex;
                const randomReflex = reflexGames[Math.floor(Math.random() * reflexGames.length)];
                allExercises.push({
                    type: 'reflex',
                    titre: randomReflex.titre,
                    duree: 2,
                    icon: '‚ö°',
                    gameData: randomReflex
                });

                // Stretch exercises
                const stretches = GAMES_DATABASE.stretch;
                const numStretches = 2;
                for (let i = 0; i < numStretches; i++) {
                    const randomStretch = stretches[Math.floor(Math.random() * stretches.length)];
                    allExercises.push({
                        type: 'stretch',
                        titre: randomStretch.titre,
                        duree: 2,
                        icon: 'üßò',
                        gameData: randomStretch
                    });
                }

                this.dailyProgram = {
                    theme: 'Programme du jour',
                    duree_totale: `${allExercises.reduce((sum, ex) => sum + ex.duree, 0)} minutes`,
                    sequence: allExercises,
                    message: `Bravo ${profile.name} ! Tu as gagn√© des pi√®ces pour ta maison ! üè†`
                };
            },

            completeExercise(points) {
                this.completedToday.push(this.currentExercise.index);
                this.stats.xp += points;
                this.stats.coins += Math.floor(points / 2);
                this.saveData();
                this.currentPage = 'dashboard';
                this.render();
            },

            render() {
                const app = document.getElementById('app');
                
                if (this.currentPage === 'welcome') {
                    app.innerHTML = this.renderWelcome();
                } else if (this.currentPage === 'login') {
                    app.innerHTML = this.renderLogin();
                } else if (this.currentPage === 'register') {
                    app.innerHTML = this.renderRegister();
                } else if (this.currentPage === 'onboarding') {
                    app.innerHTML = this.renderOnboarding();
                } else if (this.currentPage === 'dashboard') {
                    app.innerHTML = this.renderDashboard();
                } else if (this.currentPage === 'exercise') {
                    app.innerHTML = this.renderExercise();
                } else if (this.currentPage === 'house') {
                    app.innerHTML = this.renderHouse();
                } else if (this.currentPage === 'shop') {
                    app.innerHTML = this.renderShop();
                } else if (this.currentPage === 'settings') {
                    app.innerHTML = this.renderSettings();
                }
                
                this.attachEvents();
            },

            renderWelcome() {
                return `
                    <div class="min-h-screen flex items-center justify-center p-6">
                        <div class="max-w-md w-full text-center">
                            <div class="bg-white p-6 rounded-full inline-block mb-6 shadow-2xl floating">
                                <div class="text-6xl">üß†</div>
                            </div>
                            <h1 class="text-5xl font-bold text-gray-800 mb-3 title-font">NeuroFit</h1>
                            <p class="text-xl text-gray-600 mb-8">Stimulez votre corps et votre esprit</p>
                            
                            <div class="space-y-4">
                                <button onclick="App.currentPage='login'; App.render()" 
                                    class="w-full py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold rounded-xl hover:shadow-lg transition">
                                    Se connecter
                                </button>
                                <button onclick="App.currentPage='register'; App.render()"
                                    class="w-full py-4 bg-white text-purple-600 font-bold rounded-xl border-2 border-purple-600 hover:shadow-lg transition">
                                    Cr√©er un compte
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            },

            renderLogin() {
                return `
                    <div class="min-h-screen flex items-center justify-center p-6">
                        <div class="max-w-md w-full">
                            <button onclick="App.currentPage='welcome'; App.render()" 
                                class="mb-6 text-purple-600 hover:text-purple-700">
                                ‚Üê Retour
                            </button>
                            <div class="bg-white rounded-3xl shadow-xl p-8">
                                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center title-font">Connexion</h2>
                                <div id="error" class="hidden mb-4 p-4 bg-red-100 text-red-700 rounded-xl text-sm"></div>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input type="email" id="email" 
                                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Mot de passe</label>
                                        <input type="password" id="password"
                                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none">
                                    </div>
                                    <button onclick="App.handleLogin()"
                                        class="w-full py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold rounded-xl hover:shadow-lg transition">
                                        Se connecter
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },

            renderRegister() {
                return `
                    <div class="min-h-screen flex items-center justify-center p-6">
                        <div class="max-w-md w-full">
                            <button onclick="App.currentPage='welcome'; App.render()" 
                                class="mb-6 text-purple-600 hover:text-purple-700">
                                ‚Üê Retour
                            </button>
                            <div class="bg-white rounded-3xl shadow-xl p-8">
                                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center title-font">Cr√©er un compte</h2>
                                <div id="error" class="hidden mb-4 p-4 bg-red-100 text-red-700 rounded-xl text-sm"></div>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input type="email" id="email"
                                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Mot de passe</label>
                                        <input type="password" id="password"
                                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Confirmer mot de passe</label>
                                        <input type="password" id="confirm"
                                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none">
                                    </div>
                                    <button onclick="App.handleRegister()"
                                        class="w-full py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold rounded-xl hover:shadow-lg transition">
                                        Cr√©er mon compte
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },

            renderOnboarding() {
                return `
                    <div class="min-h-screen p-6">
                        <div class="max-w-2xl mx-auto">
                            <div class="text-center mb-8">
                                <h1 class="text-4xl font-bold text-gray-800 mb-2 title-font">Cr√©ons ton profil</h1>
                            </div>
                            <div class="bg-white rounded-3xl shadow-xl p-8 space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Pr√©nom</label>
                                    <input type="text" id="name"
                                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">√Çge</label>
                                        <input type="number" id="age"
                                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Genre</label>
                                        <select id="gender"
                                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none">
                                            <option value="">Choisir</option>
                                            <option value="homme">Homme</option>
                                            <option value="femme">Femme</option>
                                            <option value="autre">Autre</option>
                                        </select>
                                    </div>
                                </div>
                                <button onclick="App.handleOnboarding()"
                                    class="w-full py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold rounded-xl hover:shadow-lg transition">
                                    Commencer mon aventure ‚ú®
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            },

            renderDashboard() {
                if (!this.dailyProgram) return '';
                const progress = (this.completedToday.length / this.dailyProgram.sequence.length) * 100;
                
                let exercisesHTML = '';
                this.dailyProgram.sequence.forEach((ex, idx) => {
                    const isCompleted = this.completedToday.includes(idx);
                    exercisesHTML += `
                        <div class="bg-white rounded-2xl p-4 md:p-6 shadow-md ${isCompleted ? 'opacity-60' : ''} card-hover">
                            <div class="flex flex-col sm:flex-row justify-between items-start gap-4">
                                <div class="flex items-center gap-3 md:gap-4 w-full sm:w-auto">
                                    <div class="w-12 h-12 md:w-16 md:h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-2xl md:text-3xl flex-shrink-0">
                                        ${ex.icon}
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <h3 class="font-bold text-base md:text-lg text-gray-800 truncate">${ex.titre}</h3>
                                        <span class="text-xs bg-gray-100 px-2 md:px-3 py-1 rounded-full text-gray-600">${ex.duree} min</span>
                                    </div>
                                </div>
                                ${isCompleted ? 
                                    '<div class="text-green-500 text-2xl w-full sm:w-auto text-center">‚úì</div>' :
                                    `<button onclick="App.startExercise(${idx})"
                                        class="w-full sm:w-auto bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-3 rounded-xl font-medium hover:shadow-lg transition">
                                        Lancer
                                    </button>`
                                }
                            </div>
                        </div>
                    `;
                });

                return `
                    <div class="min-h-screen p-3 md:p-6">
                        <div class="max-w-4xl mx-auto">
                            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6 md:mb-8">
                                <div>
                                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800 title-font">Bonjour ${this.userProfile.name} ! üëã</h1>
                                    <p class="text-sm md:text-base text-gray-600">Pr√™t pour ton programme ?</p>
                                </div>
                                <div class="flex flex-wrap gap-2 md:gap-3 w-full sm:w-auto">
                                    <div class="bg-white rounded-2xl px-3 md:px-4 py-2 shadow-md">
                                        <span class="font-bold text-gray-800 text-sm md:text-base">üèÜ ${this.stats.xp} XP</span>
                                    </div>
                                    <div class="bg-white rounded-2xl px-3 md:px-4 py-2 shadow-md">
                                        <span class="font-bold text-yellow-600 text-sm md:text-base">ü™ô ${this.stats.coins}</span>
                                    </div>
                                    <button onclick="App.currentPage='house'; App.render()"
                                        class="bg-white rounded-2xl px-3 md:px-4 py-2 shadow-md hover:bg-gray-50">
                                        üè†
                                    </button>
                                    <button onclick="App.currentPage='settings'; App.render()"
                                        class="bg-white rounded-2xl px-3 md:px-4 py-2 shadow-md hover:bg-gray-50">
                                        ‚öôÔ∏è
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-3xl p-4 md:p-8 mb-4 md:mb-6 text-white shadow-xl">
                                <h2 class="text-xl md:text-2xl font-bold mb-4 title-font">${this.dailyProgram.theme}</h2>
                                <div class="bg-white/20 rounded-full h-3">
                                    <div class="bg-white h-full rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                                </div>
                                <p class="text-sm mt-2">${Math.round(progress)}% compl√©t√©</p>
                            </div>
                            
                            <div class="space-y-3 md:space-y-4">
                                ${exercisesHTML}
                            </div>

                            ${progress === 100 ? `
                                <div class="mt-4 md:mt-6 bg-gradient-to-r from-green-500 to-emerald-500 rounded-2xl p-4 md:p-6 text-white text-center shadow-xl">
                                    <div class="text-4xl mb-2">üéâ</div>
                                    <h3 class="text-xl md:text-2xl font-bold title-font">Programme termin√© !</h3>
                                    <p class="text-sm md:text-base">${this.dailyProgram.message}</p>
                                    <button onclick="App.currentPage='house'; App.render()"
                                        class="mt-4 bg-white text-green-600 px-6 md:px-8 py-3 rounded-xl font-bold hover:shadow-lg transition text-sm md:text-base">
                                        Voir ma maison üè†
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            },

            renderHouse() {
                return `
                    <div class="min-h-screen p-3 md:p-6">
                        <div class="max-w-7xl mx-auto">
                            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 md:gap-4 mb-4 md:mb-6">
                                <button onclick="App.currentPage='dashboard'; App.render()" 
                                    class="text-purple-600 hover:text-purple-700 font-medium text-sm md:text-base">
                                    ‚Üê Retour
                                </button>
                                <div class="flex gap-2 md:gap-3 w-full sm:w-auto">
                                    <div class="bg-white rounded-2xl px-3 md:px-4 py-2 shadow-md flex-1 sm:flex-initial">
                                        <span class="font-bold text-yellow-600 text-sm md:text-base">ü™ô ${this.stats.coins}</span>
                                    </div>
                                    <button onclick="App.currentPage='shop'; App.render()"
                                        class="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-4 md:px-6 py-2 rounded-xl font-medium hover:shadow-lg transition text-sm md:text-base flex-1 sm:flex-initial">
                                        üõí Boutique
                                    </button>
                                </div>
                            </div>

                            <div class="bg-white rounded-3xl shadow-xl p-4 md:p-8">
                                <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2 title-font">Ma Maison üè†</h1>
                                <p class="text-sm md:text-base text-gray-600 mb-4 md:mb-6">Clique et d√©place tes meubles pour d√©corer ta maison !</p>
                                
                                <div class="house-container overflow-x-auto">
                                    <div id="room" class="room rounded-2xl shadow-inner mx-auto" style="width: 100%; max-width: 800px; height: 400px; position: relative;">
                                        <!-- Murs -->
                                        <div class="wall wall-top"></div>
                                        <div class="wall wall-left"></div>
                                        <div class="wall wall-right"></div>
                                        <div class="wall wall-bottom"></div>
                                        
                                        <!-- Fen√™tre -->
                                        <div class="window" style="top: 60px; right: 60px; width: 80px; height: 70px;">
                                            <div style="position: absolute; top: 50%; left: 0; right: 0; height: 2px; background: #654321;"></div>
                                            <div style="position: absolute; left: 50%; top: 0; bottom: 0; width: 2px; background: #654321;"></div>
                                        </div>
                                        
                                        <!-- Porte -->
                                        <div class="door" style="bottom: 40px; left: 60px; width: 60px; height: 90px;">
                                            <div class="door-handle"></div>
                                        </div>
                                        
                                        <!-- Meubles -->
                                        ${this.renderFurnitureInRoom()}
                                    </div>
                                </div>
                                
                                ${this.house.length === 0 ? `
                                    <div class="text-center mt-6 md:mt-8 py-6 md:py-8 bg-purple-50 rounded-2xl">
                                        <p class="text-gray-600 mb-2 text-sm md:text-base">Ta maison est vide !</p>
                                        <p class="text-gray-500 text-xs md:text-sm">Va √† la boutique pour acheter des meubles</p>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            },

            renderFurnitureInRoom() {
                return this.house.map((item, index) => {
                    // Utiliser les positions sauvegard√©es ou calculer une position non-chevauchante
                    let x = item.x;
                    let y = item.y;
                    
                    if (x === undefined || y === undefined) {
                        // Calculer une position en grille pour √©viter les chevauchements
                        const gridSize = 3;
                        const cellWidth = (800 - 90) / gridSize; // 800 - marges
                        const cellHeight = (600 - 90) / gridSize;
                        
                        const row = Math.floor(index / gridSize);
                        const col = index % gridSize;
                        
                        x = 60 + (col * cellWidth) + (cellWidth / 2) - (item.width / 2);
                        y = 60 + (row * cellHeight) + (cellHeight / 2) - (item.height / 2);
                        
                        // Sauvegarder ces positions
                        this.house[index].x = x;
                        this.house[index].y = y;
                    }
                    
                    // Convertir en pourcentage pour √™tre responsive
                    const xPercent = (x / 800) * 100;
                    const yPercent = (y / 600) * 100;
                    const widthPercent = (item.width / 800) * 100;
                    const heightPercent = (item.height / 600) * 100;
                    
                    const size = Math.max(item.width, item.height) || 80;
                    const fontSize = size * 0.6;
                    
                    return `
                        <div class="furniture-item" 
                             data-id="${item.id}"
                             data-index="${index}"
                             style="left: ${xPercent}%; top: ${yPercent}%; width: ${widthPercent}%; height: ${heightPercent}%;"
                             onmousedown="App.startDrag(event, ${index})"
                             ontouchstart="App.startDragTouch(event, ${index})">
                            <div style="font-size: ${fontSize}px; text-align: center; cursor: move; user-select: none; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                                ${item.icon}
                            </div>
                        </div>
                    `;
                }).join('');
            },

            startDrag(event, index) {
                event.preventDefault();
                this.draggedItem = index;
                
                const element = event.currentTarget;
                const rect = element.getBoundingClientRect();
                const roomRect = document.getElementById('room').getBoundingClientRect();
                
                this.dragOffset = {
                    x: event.clientX - rect.left,
                    y: event.clientY - rect.top
                };
                
                element.classList.add('dragging');
                element.style.zIndex = '1000';
                
                const handleMouseMove = (e) => {
                    if (this.draggedItem === null) return;
                    
                    const roomRect = document.getElementById('room').getBoundingClientRect();
                    const roomWidth = roomRect.width;
                    const roomHeight = roomRect.height;
                    
                    let newX = e.clientX - roomRect.left - this.dragOffset.x;
                    let newY = e.clientY - roomRect.top - this.dragOffset.y;
                    
                    // Contraintes pour rester dans la pi√®ce
                    const item = this.house[this.draggedItem];
                    const itemWidth = (item.width || 80) * (roomWidth / 800); // Adapter √† la taille r√©elle
                    const itemHeight = (item.height || 80) * (roomHeight / 600);
                    
                    const minX = 45 * (roomWidth / 800);
                    const minY = 45 * (roomHeight / 600);
                    const maxX = roomWidth - minX - itemWidth;
                    const maxY = roomHeight - minY - itemHeight;
                    
                    newX = Math.max(minX, Math.min(maxX, newX));
                    newY = Math.max(minY, Math.min(maxY, newY));
                    
                    element.style.left = newX + 'px';
                    element.style.top = newY + 'px';
                };
                
                const handleMouseUp = (e) => {
                    if (this.draggedItem !== null) {
                        const roomRect = document.getElementById('room').getBoundingClientRect();
                        const roomWidth = roomRect.width;
                        const roomHeight = roomRect.height;
                        
                        let finalX = e.clientX - roomRect.left - this.dragOffset.x;
                        let finalY = e.clientY - roomRect.top - this.dragOffset.y;
                        
                        const item = this.house[this.draggedItem];
                        const itemWidth = (item.width || 80) * (roomWidth / 800);
                        const itemHeight = (item.height || 80) * (roomHeight / 600);
                        
                        const minX = 45 * (roomWidth / 800);
                        const minY = 45 * (roomHeight / 600);
                        const maxX = roomWidth - minX - itemWidth;
                        const maxY = roomHeight - minY - itemHeight;
                        
                        finalX = Math.max(minX, Math.min(maxX, finalX));
                        finalY = Math.max(minY, Math.min(maxY, finalY));
                        
                        // Normaliser les positions pour 800x600 (dimensions de r√©f√©rence)
                        this.house[this.draggedItem].x = (finalX / roomWidth) * 800;
                        this.house[this.draggedItem].y = (finalY / roomHeight) * 600;
                        
                        this.saveData();
                        
                        element.classList.remove('dragging');
                        element.style.zIndex = '10';
                    }
                    
                    this.draggedItem = null;
                    document.removeEventListener('mousemove', handleMouseMove);
                    document.removeEventListener('mouseup', handleMouseUp);
                };
                
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
            },

            startDragTouch(event, index) {
                event.preventDefault();
                this.draggedItem = index;
                
                const element = event.currentTarget;
                const touch = event.touches[0];
                const rect = element.getBoundingClientRect();
                const roomRect = document.getElementById('room').getBoundingClientRect();
                
                this.dragOffset = {
                    x: touch.clientX - rect.left,
                    y: touch.clientY - rect.top
                };
                
                element.classList.add('dragging');
                element.style.zIndex = '1000';
                
                const handleTouchMove = (e) => {
                    if (this.draggedItem === null) return;
                    e.preventDefault();
                    
                    const touch = e.touches[0];
                    const roomRect = document.getElementById('room').getBoundingClientRect();
                    const roomWidth = roomRect.width;
                    const roomHeight = roomRect.height;
                    
                    let newX = touch.clientX - roomRect.left - this.dragOffset.x;
                    let newY = touch.clientY - roomRect.top - this.dragOffset.y;
                    
                    const item = this.house[this.draggedItem];
                    const itemWidth = (item.width || 80) * (roomWidth / 800);
                    const itemHeight = (item.height || 80) * (roomHeight / 600);
                    
                    const minX = 45 * (roomWidth / 800);
                    const minY = 45 * (roomHeight / 600);
                    const maxX = roomWidth - minX - itemWidth;
                    const maxY = roomHeight - minY - itemHeight;
                    
                    newX = Math.max(minX, Math.min(maxX, newX));
                    newY = Math.max(minY, Math.min(maxY, newY));
                    
                    element.style.left = newX + 'px';
                    element.style.top = newY + 'px';
                };
                
                const handleTouchEnd = (e) => {
                    if (this.draggedItem !== null) {
                        const touch = e.changedTouches[0];
                        const roomRect = document.getElementById('room').getBoundingClientRect();
                        const roomWidth = roomRect.width;
                        const roomHeight = roomRect.height;
                        
                        let finalX = touch.clientX - roomRect.left - this.dragOffset.x;
                        let finalY = touch.clientY - roomRect.top - this.dragOffset.y;
                        
                        const item = this.house[this.draggedItem];
                        const itemWidth = (item.width || 80) * (roomWidth / 800);
                        const itemHeight = (item.height || 80) * (roomHeight / 600);
                        
                        const minX = 45 * (roomWidth / 800);
                        const minY = 45 * (roomHeight / 600);
                        const maxX = roomWidth - minX - itemWidth;
                        const maxY = roomHeight - minY - itemHeight;
                        
                        finalX = Math.max(minX, Math.min(maxX, finalX));
                        finalY = Math.max(minY, Math.min(maxY, finalY));
                        
                        this.house[this.draggedItem].x = (finalX / roomWidth) * 800;
                        this.house[this.draggedItem].y = (finalY / roomHeight) * 600;
                        
                        this.saveData();
                        
                        element.classList.remove('dragging');
                        element.style.zIndex = '10';
                    }
                    
                    this.draggedItem = null;
                    document.removeEventListener('touchmove', handleTouchMove);
                    document.removeEventListener('touchend', handleTouchEnd);
                };
                
                document.addEventListener('touchmove', handleTouchMove, { passive: false });
                document.addEventListener('touchend', handleTouchEnd);
            },

            renderShop() {
                let shopHTML = '';
                const categories = {
                    furniture: 'üõãÔ∏è Meubles',
                    decoration: 'üé® D√©corations',
                    tech: 'üîå √âlectronique',
                    luxury: 'üíé Luxe'
                };

                Object.keys(categories).forEach(cat => {
                    const items = HOUSE_ITEMS[cat];
                    shopHTML += `
                        <div class="mb-6 md:mb-8">
                            <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4 title-font">${categories[cat]}</h3>
                            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4">
                                ${items.map(item => {
                                    const owned = this.house.some(h => h.id === item.id);
                                    const canBuy = this.stats.coins >= item.cost;
                                    return `
                                        <div class="bg-white rounded-xl p-3 md:p-4 shadow-md ${owned ? 'opacity-50' : 'shop-item'}">
                                            <div class="text-4xl md:text-5xl mb-2 md:mb-3 text-center">${item.icon}</div>
                                            <div class="text-center">
                                                <div class="font-bold text-gray-800 mb-1 text-xs md:text-sm">${item.name}</div>
                                                <div class="text-yellow-600 font-bold mb-2 md:mb-3 text-sm md:text-base">ü™ô ${item.cost}</div>
                                                ${owned ? 
                                                    '<div class="text-green-600 text-xs md:text-sm font-medium">‚úì Poss√©d√©</div>' :
                                                    `<button onclick="App.buyItem('${item.id}', '${cat}')"
                                                        class="w-full py-2 text-xs md:text-sm ${canBuy ? 'bg-gradient-to-r from-purple-600 to-blue-600 text-white hover:shadow-lg' : 'bg-gray-300 text-gray-500 cursor-not-allowed'} rounded-lg font-medium transition"
                                                        ${!canBuy ? 'disabled' : ''}>
                                                        ${canBuy ? 'Acheter' : 'Pas assez'}
                                                    </button>`
                                                }
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                });

                return `
                    <div class="min-h-screen p-3 md:p-6">
                        <div class="max-w-6xl mx-auto">
                            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 md:gap-4 mb-4 md:mb-6">
                                <button onclick="App.currentPage='house'; App.render()" 
                                    class="text-purple-600 hover:text-purple-700 font-medium text-sm md:text-base">
                                    ‚Üê Retour
                                </button>
                                <div class="bg-white rounded-2xl px-4 md:px-6 py-2 md:py-3 shadow-md w-full sm:w-auto text-center">
                                    <span class="font-bold text-yellow-600 text-base md:text-lg">ü™ô ${this.stats.coins}</span>
                                </div>
                            </div>

                            <div class="bg-white rounded-3xl shadow-xl p-4 md:p-8">
                                <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2 title-font">üõí Boutique</h1>
                                <p class="text-sm md:text-base text-gray-600 mb-6 md:mb-8">D√©core ta maison avec tes pi√®ces !</p>
                                
                                ${shopHTML}
                            </div>
                        </div>
                    </div>
                `;
            },

            renderSettings() {
                if (!this.settings) {
                    this.settings = { notifications: false, notificationTime: '09:00' };
                }
                
                return `
                    <div class="min-h-screen p-3 md:p-6">
                        <div class="max-w-2xl mx-auto">
                            <div class="flex justify-between items-center mb-4 md:mb-6">
                                <button onclick="App.currentPage='dashboard'; App.render()" 
                                    class="text-purple-600 hover:text-purple-700 font-medium text-sm md:text-base">
                                    ‚Üê Retour
                                </button>
                            </div>

                            <div class="bg-white rounded-3xl shadow-xl p-4 md:p-8">
                                <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2 title-font">‚öôÔ∏è Param√®tres</h1>
                                <p class="text-sm md:text-base text-gray-600 mb-6 md:mb-8">Personnalise ton exp√©rience NeuroFit</p>
                                
                                <!-- Section Notifications -->
                                <div class="mb-6 md:mb-8">
                                    <h2 class="text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4">üîî Notifications</h2>
                                    
                                    <div class="bg-gray-50 rounded-2xl p-4 md:p-6">
                                        <div>
                                            <label class="block text-xs md:text-sm font-medium text-gray-700 mb-2">
                                                Recevoir un rappel quotidien
                                            </label>
                                            <select id="notificationSelect" 
                                                    class="w-full px-3 md:px-4 py-2 md:py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none bg-white text-sm md:text-base">
                                                <option value="never" ${!this.settings.notifications ? 'selected' : ''}>Jamais</option>
                                                <option value="00:00" ${this.settings.notifications && this.settings.notificationTime === '00:00' ? 'selected' : ''}>00:00 - Minuit</option>
                                                <option value="01:00" ${this.settings.notifications && this.settings.notificationTime === '01:00' ? 'selected' : ''}>01:00</option>
                                                <option value="02:00" ${this.settings.notifications && this.settings.notificationTime === '02:00' ? 'selected' : ''}>02:00</option>
                                                <option value="03:00" ${this.settings.notifications && this.settings.notificationTime === '03:00' ? 'selected' : ''}>03:00</option>
                                                <option value="04:00" ${this.settings.notifications && this.settings.notificationTime === '04:00' ? 'selected' : ''}>04:00</option>
                                                <option value="05:00" ${this.settings.notifications && this.settings.notificationTime === '05:00' ? 'selected' : ''}>05:00</option>
                                                <option value="06:00" ${this.settings.notifications && this.settings.notificationTime === '06:00' ? 'selected' : ''}>06:00</option>
                                                <option value="07:00" ${this.settings.notifications && this.settings.notificationTime === '07:00' ? 'selected' : ''}>07:00</option>
                                                <option value="08:00" ${this.settings.notifications && this.settings.notificationTime === '08:00' ? 'selected' : ''}>08:00</option>
                                                <option value="09:00" ${this.settings.notifications && this.settings.notificationTime === '09:00' ? 'selected' : ''}>09:00</option>
                                                <option value="10:00" ${this.settings.notifications && this.settings.notificationTime === '10:00' ? 'selected' : ''}>10:00</option>
                                                <option value="11:00" ${this.settings.notifications && this.settings.notificationTime === '11:00' ? 'selected' : ''}>11:00</option>
                                                <option value="12:00" ${this.settings.notifications && this.settings.notificationTime === '12:00' ? 'selected' : ''}>12:00 - Midi</option>
                                                <option value="13:00" ${this.settings.notifications && this.settings.notificationTime === '13:00' ? 'selected' : ''}>13:00</option>
                                                <option value="14:00" ${this.settings.notifications && this.settings.notificationTime === '14:00' ? 'selected' : ''}>14:00</option>
                                                <option value="15:00" ${this.settings.notifications && this.settings.notificationTime === '15:00' ? 'selected' : ''}>15:00</option>
                                                <option value="16:00" ${this.settings.notifications && this.settings.notificationTime === '16:00' ? 'selected' : ''}>16:00</option>
                                                <option value="17:00" ${this.settings.notifications && this.settings.notificationTime === '17:00' ? 'selected' : ''}>17:00</option>
                                                <option value="18:00" ${this.settings.notifications && this.settings.notificationTime === '18:00' ? 'selected' : ''}>18:00</option>
                                                <option value="19:00" ${this.settings.notifications && this.settings.notificationTime === '19:00' ? 'selected' : ''}>19:00</option>
                                                <option value="20:00" ${this.settings.notifications && this.settings.notificationTime === '20:00' ? 'selected' : ''}>20:00</option>
                                                <option value="21:00" ${this.settings.notifications && this.settings.notificationTime === '21:00' ? 'selected' : ''}>21:00</option>
                                                <option value="22:00" ${this.settings.notifications && this.settings.notificationTime === '22:00' ? 'selected' : ''}>22:00</option>
                                                <option value="23:00" ${this.settings.notifications && this.settings.notificationTime === '23:00' ? 'selected' : ''}>23:00</option>
                                            </select>
                                            <p class="text-xs text-gray-500 mt-2">
                                                ${this.settings.notifications ? `Tu recevras une notification √† ${this.settings.notificationTime} pour te rappeler de faire tes d√©fis` : 'S√©lectionne une heure pour activer les notifications'}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Section Compte -->
                                <div class="mb-6 md:mb-8">
                                    <h2 class="text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4">üë§ Compte</h2>
                                    
                                    <div class="bg-gray-50 rounded-2xl p-4 md:p-6 space-y-3 md:space-y-4">
                                        <div>
                                            <p class="text-xs md:text-sm text-gray-600">Email</p>
                                            <p class="font-bold text-gray-800 text-sm md:text-base break-all">${this.currentUser}</p>
                                        </div>
                                        <div>
                                            <p class="text-xs md:text-sm text-gray-600">Pr√©nom</p>
                                            <p class="font-bold text-gray-800 text-sm md:text-base">${this.userProfile.name}</p>
                                        </div>
                                        <div class="grid grid-cols-2 gap-3 md:gap-4">
                                            <div>
                                                <p class="text-xs md:text-sm text-gray-600">√Çge</p>
                                                <p class="font-bold text-gray-800 text-sm md:text-base">${this.userProfile.age} ans</p>
                                            </div>
                                            <div>
                                                <p class="text-xs md:text-sm text-gray-600">Genre</p>
                                                <p class="font-bold text-gray-800 capitalize text-sm md:text-base">${this.userProfile.gender}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Section Statistiques -->
                                <div class="mb-6 md:mb-8">
                                    <h2 class="text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4">üìä Statistiques</h2>
                                    
                                    <div class="bg-gray-50 rounded-2xl p-4 md:p-6">
                                        <div class="grid grid-cols-3 gap-3 md:gap-4 text-center">
                                            <div>
                                                <p class="text-2xl md:text-3xl font-bold text-purple-600">${this.stats.xp}</p>
                                                <p class="text-xs md:text-sm text-gray-600">XP Total</p>
                                            </div>
                                            <div>
                                                <p class="text-2xl md:text-3xl font-bold text-yellow-600">${this.stats.coins}</p>
                                                <p class="text-xs md:text-sm text-gray-600">Pi√®ces</p>
                                            </div>
                                            <div>
                                                <p class="text-2xl md:text-3xl font-bold text-orange-600">${this.stats.streak || 0}</p>
                                                <p class="text-xs md:text-sm text-gray-600">S√©rie (jours)</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- D√©connexion -->
                                <button onclick="App.logout()"
                                    class="w-full py-3 md:py-4 bg-red-500 text-white font-bold rounded-xl hover:bg-red-600 transition text-sm md:text-base">
                                    Se d√©connecter
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            },

            buyItem(itemId, category) {
                const item = HOUSE_ITEMS[category].find(i => i.id === itemId);
                if (!item || this.stats.coins < item.cost) return;
                
                if (this.house.some(h => h.id === itemId)) {
                    alert('Tu poss√®des d√©j√† cet objet !');
                    return;
                }
                
                this.stats.coins -= item.cost;
                this.house.push({
                    ...item,
                    x: 150 + (this.house.length * 20),
                    y: 150 + (this.house.length * 20)
                });
                this.saveData();
                this.render();
            },

            async toggleNotifications() {
                if (!this.settings) {
                    this.settings = { notifications: false, notificationTime: '09:00' };
                }
                
                this.settings.notifications = !this.settings.notifications;
                
                if (this.settings.notifications && 'Notification' in window) {
                    const permission = await Notification.requestPermission();
                    if (permission !== 'granted') {
                        this.settings.notifications = false;
                        alert('Les notifications ont √©t√© refus√©es. Active-les dans les param√®tres de ton navigateur pour recevoir des rappels.');
                    } else {
                        // Envoyer une notification de test
                        new Notification('NeuroFit - Notifications activ√©es ! üéâ', {
                            body: 'Tu recevras un rappel quotidien √† ' + this.settings.notificationTime,
                            icon: 'üß†'
                        });
                    }
                } else if (this.settings.notifications && !('Notification' in window)) {
                    this.settings.notifications = false;
                    alert('Ton navigateur ne supporte pas les notifications.');
                }
                
                this.saveData();
                this.render();
            },

            async handleNotificationChange(value) {
                if (!this.settings) {
                    this.settings = { notifications: false, notificationTime: '09:00' };
                }
                
                if (value === 'jamais') {
                    // D√©sactiver les notifications
                    this.settings.notifications = false;
                } else {
                    // Activer les notifications avec l'heure choisie
                    this.settings.notificationTime = value;
                    
                    // Demander la permission si ce n'est pas d√©j√† fait
                    if ('Notification' in window) {
                        const permission = await Notification.requestPermission();
                        if (permission !== 'granted') {
                            this.settings.notifications = false;
                            alert('Les notifications ont √©t√© refus√©es. Active-les dans les param√®tres de ton navigateur pour recevoir des rappels.');
                            // Remettre le select sur "jamais"
                            const select = document.getElementById('notificationSelect');
                            if (select) select.value = 'jamais';
                        } else {
                            this.settings.notifications = true;
                            // Envoyer une notification de test
                            new Notification('NeuroFit - Notifications activ√©es ! üéâ', {
                                body: `Tu recevras un rappel quotidien √† ${value}`,
                                icon: 'üß†'
                            });
                        }
                    } else {
                        this.settings.notifications = false;
                        alert('Ton navigateur ne supporte pas les notifications.');
                        // Remettre le select sur "jamais"
                        const select = document.getElementById('notificationSelect');
                        if (select) select.value = 'jamais';
                    }
                }
                
                this.saveData();
                this.render();
            },

            updateNotificationTime(time) {
                if (!this.settings) {
                    this.settings = { notifications: false, notificationTime: '09:00' };
                }
                this.settings.notificationTime = time;
                this.saveData();
                
                // Mettre √† jour le texte affich√© sans re-rendre toute la page
                const displayText = document.querySelector('.text-xs.text-gray-500.mt-2');
                if (displayText) {
                    displayText.textContent = `Tu recevras une notification √† ${time} pour te rappeler de faire tes d√©fis`;
                }
            },

            renderExercise() {
                if (!this.currentExercise) return '';
                
                if (this.currentExercise.type === 'stretch') {
                    return this.renderStretch();
                } else if (this.currentExercise.type === 'memory') {
                    return this.renderMemoryGame();
                } else if (this.currentExercise.type === 'math') {
                    return this.renderMathGame();
                } else if (this.currentExercise.type === 'puzzle') {
                    return this.renderPuzzleGame();
                } else if (this.currentExercise.type === 'reflex') {
                    return this.renderReflexGame();
                }
                return '';
            },

            renderStretch() {
                const instructions = this.currentExercise.gameData.instructions;
                return `
                    <div class="min-h-screen p-6 flex items-center justify-center">
                        <div class="bg-white rounded-3xl p-8 max-w-2xl w-full">
                            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center title-font">${this.currentExercise.titre}</h2>
                            <div class="text-9xl text-center mb-8">üßò</div>
                            <div class="bg-blue-50 rounded-2xl p-6 mb-6">
                                <p class="text-gray-700 mb-4 font-semibold">Suis ces instructions :</p>
                                <ul class="space-y-3">
                                    ${instructions.map((inst, i) => `
                                        <li class="flex gap-3">
                                            <span class="font-bold text-purple-600">${i + 1}.</span>
                                            <span class="text-gray-700">${inst}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                            <button onclick="App.completeExercise(50)"
                                class="w-full py-4 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-bold rounded-xl hover:shadow-lg transition">
                                ‚úì Terminer l'√©tirement
                            </button>
                        </div>
                    </div>
                `;
            },

            renderMemoryGame() {
                if (!this.gameState) {
                    const cards = this.currentExercise.gameData.cards;
                    const doubleCards = [...cards, ...cards];
                    this.gameState = {
                        cards: doubleCards.sort(() => Math.random() - 0.5),
                        flipped: [],
                        matched: []
                    };
                }

                let cardsHTML = '';
                this.gameState.cards.forEach((card, idx) => {
                    const isFlipped = this.gameState.flipped.includes(idx) || this.gameState.matched.includes(idx);
                    cardsHTML += `
                        <button onclick="App.flipCard(${idx})"
                            class="aspect-square rounded-2xl text-6xl flex items-center justify-center font-bold transition ${
                                isFlipped ? 'bg-gradient-to-br from-blue-400 to-purple-500' : 'bg-gray-300 hover:bg-gray-400'
                            }">
                            ${isFlipped ? card : '?'}
                        </button>
                    `;
                });

                return `
                    <div class="min-h-screen p-6 flex items-center justify-center">
                        <div class="bg-white rounded-3xl p-8 max-w-4xl w-full">
                            <h2 class="text-3xl font-bold text-gray-800 mb-6 title-font">${this.currentExercise.titre}</h2>
                            <div class="grid grid-cols-4 gap-4 mb-6">
                                ${cardsHTML}
                            </div>
                            ${this.gameState.matched.length === this.gameState.cards.length ? `
                                <div class="text-center">
                                    <p class="text-2xl font-bold text-green-600 mb-4">Bravo ! üéâ</p>
                                    <button onclick="App.completeExercise(100)"
                                        class="px-12 py-4 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-bold rounded-xl hover:shadow-lg transition">
                                        Continuer
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            },

            renderMathGame() {
                if (!this.gameState) {
                    const gameData = this.currentExercise.gameData;
                    const maxNum = gameData.maxNumber;
                    
                    let operator = gameData.operator;
                    if (operator === 'mixed') {
                        operator = ['+', '-', '√ó'][Math.floor(Math.random() * 3)];
                    }
                    
                    const num1 = Math.floor(Math.random() * maxNum) + 1;
                    const num2 = Math.floor(Math.random() * maxNum) + 1;
                    
                    let answer;
                    if (operator === '+') answer = num1 + num2;
                    else if (operator === '-') answer = Math.max(num1, num2) - Math.min(num1, num2);
                    else answer = num1 * num2;
                    
                    this.gameState = {
                        num1: operator === '-' ? Math.max(num1, num2) : num1,
                        num2: operator === '-' ? Math.min(num1, num2) : num2,
                        operator,
                        answer,
                        score: 0,
                        questions: 0,
                        maxNum,
                        gameData
                    };
                }

                return `
                    <div class="min-h-screen p-6 flex items-center justify-center">
                        <div class="bg-white rounded-3xl p-8 max-w-2xl w-full text-center">
                            <h2 class="text-3xl font-bold text-gray-800 mb-4 title-font">${this.currentExercise.titre}</h2>
                            <div class="text-xl font-bold text-purple-600 mb-6">Score: ${this.gameState.score} / ${this.gameState.questions}</div>
                            
                            ${this.gameState.questions < 10 ? `
                                <div class="text-7xl font-bold text-blue-600 mb-8">
                                    ${this.gameState.num1} ${this.gameState.operator} ${this.gameState.num2} = ?
                                </div>
                                <input type="number" id="mathAnswer"
                                    class="text-6xl font-bold text-center border-4 border-purple-300 rounded-2xl p-4 mb-6 w-full focus:border-purple-500 focus:outline-none">
                                <button onclick="App.checkMathAnswer()"
                                    class="px-12 py-4 bg-gradient-to-r from-green-500 to-emerald-500 text-white text-xl font-bold rounded-xl hover:shadow-lg transition">
                                    Valider
                                </button>
                            ` : `
                                <div class="text-4xl font-bold text-green-600 mb-4">Termin√© !</div>
                                <p class="text-2xl text-gray-700 mb-6">Score final: ${this.gameState.score} / 10</p>
                                <button onclick="App.completeExercise(${this.gameState.score * 10})"
                                    class="px-12 py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold rounded-xl hover:shadow-lg transition">
                                    Continuer
                                </button>
                            `}
                        </div>
                    </div>
                `;
            },

            renderPuzzleGame() {
                const puzzleType = this.currentExercise.gameData.type;
                
                if (puzzleType === 'sequence') {
                    return this.renderSequencePuzzle();
                } else if (puzzleType === 'pattern') {
                    return this.renderPatternPuzzle();
                } else if (puzzleType === 'anagram') {
                    return this.renderAnagramPuzzle();
                }
                return '';
            },

            renderSequencePuzzle() {
                if (!this.gameState) {
                    const sequences = [
                        { seq: [2, 4, 6, 8], answer: 10 },
                        { seq: [1, 3, 5, 7], answer: 9 },
                        { seq: [5, 10, 15, 20], answer: 25 },
                        { seq: [3, 6, 9, 12], answer: 15 },
                        { seq: [10, 20, 30, 40], answer: 50 },
                        { seq: [1, 2, 4, 8], answer: 16 },
                        { seq: [100, 90, 80, 70], answer: 60 },
                        { seq: [1, 4, 9, 16], answer: 25 }
                    ];
                    
                    const randomSeq = sequences[Math.floor(Math.random() * sequences.length)];
                    this.gameState = {
                        current: randomSeq,
                        score: 0,
                        questions: 0,
                        allSequences: sequences
                    };
                }

                return `
                    <div class="min-h-screen p-6 flex items-center justify-center">
                        <div class="bg-white rounded-3xl p-8 max-w-2xl w-full text-center">
                            <h2 class="text-3xl font-bold text-gray-800 mb-4 title-font">S√©quence de Chiffres</h2>
                            <div class="text-xl font-bold text-purple-600 mb-6">Score: ${this.gameState.score} / ${this.gameState.questions}</div>
                            
                            ${this.gameState.questions < 5 ? `
                                <p class="text-gray-600 mb-6">Quel est le prochain nombre ?</p>
                                <div class="text-5xl font-bold text-blue-600 mb-8">
                                    ${this.gameState.current.seq.join(' ‚Üí ')} ‚Üí ?
                                </div>
                                <input type="number" id="sequenceAnswer"
                                    class="text-5xl font-bold text-center border-4 border-purple-300 rounded-2xl p-4 mb-6 w-full focus:border-purple-500 focus:outline-none">
                                <button onclick="App.checkSequenceAnswer()"
                                    class="px-12 py-4 bg-gradient-to-r from-green-500 to-emerald-500 text-white text-xl font-bold rounded-xl hover:shadow-lg transition">
                                    Valider
                                </button>
                            ` : `
                                <div class="text-4xl font-bold text-green-600 mb-4">Termin√© !</div>
                                <p class="text-2xl text-gray-700 mb-6">Score final: ${this.gameState.score} / 5</p>
                                <button onclick="App.completeExercise(${this.gameState.score * 20})"
                                    class="px-12 py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold rounded-xl hover:shadow-lg transition">
                                    Continuer
                                </button>
                            `}
                        </div>
                    </div>
                `;
            },

            renderPatternPuzzle() {
                if (!this.gameState) {
                    const patterns = [
                        { pattern: ['üî¥', 'üîµ', 'üî¥', 'üîµ'], answer: 'üî¥', options: ['üî¥', 'üîµ', 'üü°'] },
                        { pattern: ['‚≠ê', '‚≠ê', '‚ù§Ô∏è', '‚≠ê', '‚≠ê'], answer: '‚ù§Ô∏è', options: ['‚≠ê', '‚ù§Ô∏è', 'üíô'] },
                        { pattern: ['üåô', '‚òÄÔ∏è', 'üåô', '‚òÄÔ∏è'], answer: 'üåô', options: ['üåô', '‚òÄÔ∏è', '‚≠ê'] },
                        { pattern: ['üçé', 'üçå', 'üçé', 'üçå'], answer: 'üçé', options: ['üçé', 'üçå', 'üçá'] }
                    ];
                    
                    const randomPattern = patterns[Math.floor(Math.random() * patterns.length)];
                    this.gameState = {
                        current: randomPattern,
                        score: 0,
                        questions: 0,
                        allPatterns: patterns
                    };
                }

                return `
                    <div class="min-h-screen p-6 flex items-center justify-center">
                        <div class="bg-white rounded-3xl p-8 max-w-2xl w-full text-center">
                            <h2 class="text-3xl font-bold text-gray-800 mb-4 title-font">Motifs Logiques</h2>
                            <div class="text-xl font-bold text-purple-600 mb-6">Score: ${this.gameState.score} / ${this.gameState.questions}</div>
                            
                            ${this.gameState.questions < 5 ? `
                                <p class="text-gray-600 mb-6">Quel symbole vient ensuite ?</p>
                                <div class="text-6xl mb-8 flex justify-center gap-4">
                                    ${this.gameState.current.pattern.map(p => `<span>${p}</span>`).join('')}
                                    <span class="text-gray-300">?</span>
                                </div>
                                <div class="flex justify-center gap-6">
                                    ${this.gameState.current.options.map(opt => `
                                        <button onclick="App.checkPatternAnswer('${opt}')"
                                            class="text-6xl p-6 bg-gray-100 rounded-2xl hover:bg-purple-100 transition">
                                            ${opt}
                                        </button>
                                    `).join('')}
                                </div>
                            ` : `
                                <div class="text-4xl font-bold text-green-600 mb-4">Termin√© !</div>
                                <p class="text-2xl text-gray-700 mb-6">Score final: ${this.gameState.score} / 5</p>
                                <button onclick="App.completeExercise(${this.gameState.score * 20})"
                                    class="px-12 py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold rounded-xl hover:shadow-lg transition">
                                    Continuer
                                </button>
                            `}
                        </div>
                    </div>
                `;
            },

            renderAnagramPuzzle() {
                if (!this.gameState) {
                    const words = [
                        { word: 'MAISON', scrambled: 'NOMAIS' },
                        { word: 'SOLEIL', scrambled: 'LSOEIL' },
                        { word: 'FLEUR', scrambled: 'LURFE' },
                        { word: 'CHAT', scrambled: 'TACH' },
                        { word: 'LIVRE', scrambled: 'VERIL' },
                        { word: 'ARBRE', scrambled: 'RBEAR' }
                    ];
                    
                    const randomWord = words[Math.floor(Math.random() * words.length)];
                    this.gameState = {
                        current: randomWord,
                        score: 0,
                        questions: 0,
                        allWords: words
                    };
                }

                return `
                    <div class="min-h-screen p-6 flex items-center justify-center">
                        <div class="bg-white rounded-3xl p-8 max-w-2xl w-full text-center">
                            <h2 class="text-3xl font-bold text-gray-800 mb-4 title-font">Anagrammes</h2>
                            <div class="text-xl font-bold text-purple-600 mb-6">Score: ${this.gameState.score} / ${this.gameState.questions}</div>
                            
                            ${this.gameState.questions < 5 ? `
                                <p class="text-gray-600 mb-6">Remets les lettres dans l'ordre :</p>
                                <div class="text-6xl font-bold text-blue-600 mb-8 tracking-wider">
                                    ${this.gameState.current.scrambled}
                                </div>
                                <input type="text" id="anagramAnswer"
                                    class="text-4xl font-bold text-center border-4 border-purple-300 rounded-2xl p-4 mb-6 w-full uppercase focus:border-purple-500 focus:outline-none">
                                <button onclick="App.checkAnagramAnswer()"
                                    class="px-12 py-4 bg-gradient-to-r from-green-500 to-emerald-500 text-white text-xl font-bold rounded-xl hover:shadow-lg transition">
                                    Valider
                                </button>
                            ` : `
                                <div class="text-4xl font-bold text-green-600 mb-4">Termin√© !</div>
                                <p class="text-2xl text-gray-700 mb-6">Score final: ${this.gameState.score} / 5</p>
                                <button onclick="App.completeExercise(${this.gameState.score * 20})"
                                    class="px-12 py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold rounded-xl hover:shadow-lg transition">
                                    Continuer
                                </button>
                            `}
                        </div>
                    </div>
                `;
            },

            renderReflexGame() {
                const reflexType = this.currentExercise.gameData.type;
                
                if (reflexType === 'click') {
                    return this.renderClickReflexGame();
                } else if (reflexType === 'color') {
                    return this.renderColorReflexGame();
                }
                return '';
            },

            renderClickReflexGame() {
                if (!this.gameState) {
                    this.gameState = {
                        waiting: true,
                        startTime: null,
                        score: [],
                        round: 0
                    };
                    
                    setTimeout(() => {
                        this.gameState.waiting = false;
                        this.gameState.startTime = Date.now();
                        this.render();
                    }, Math.random() * 3000 + 1000);
                }

                return `
                    <div class="min-h-screen p-6 flex items-center justify-center">
                        <div class="bg-white rounded-3xl p-8 max-w-2xl w-full text-center">
                            <h2 class="text-3xl font-bold text-gray-800 mb-6 title-font">Test de R√©flexes</h2>
                            
                            ${this.gameState.round < 5 ? `
                                <div class="mb-6">
                                    <p class="text-gray-600">Essai ${this.gameState.round + 1} / 5</p>
                                </div>
                                
                                ${this.gameState.waiting ? `
                                    <div class="bg-red-500 rounded-3xl p-20 mb-6">
                                        <p class="text-white text-2xl font-bold">Attendez...</p>
                                    </div>
                                ` : `
                                    <button onclick="App.handleReflexClick()"
                                        class="w-full bg-green-500 rounded-3xl p-20 mb-6 hover:bg-green-600 transition">
                                        <p class="text-white text-3xl font-bold">CLIQUEZ !</p>
                                    </button>
                                `}
                                
                                ${this.gameState.score.length > 0 ? `
                                    <div class="bg-blue-50 rounded-2xl p-4">
                                        <p class="font-semibold text-gray-700">Temps :</p>
                                        <div class="flex justify-center gap-4 mt-2">
                                            ${this.gameState.score.map((s, i) => `
                                                <span class="text-sm font-bold">${i+1}: ${s}ms</span>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                            ` : `
                                <div class="text-4xl font-bold text-green-600 mb-4">Termin√© !</div>
                                <p class="text-2xl text-gray-700 mb-4">Temps moyen de r√©action :</p>
                                <p class="text-5xl font-bold text-purple-600 mb-6">
                                    ${Math.round(this.gameState.score.reduce((a,b) => a+b, 0) / this.gameState.score.length)}ms
                                </p>
                                <button onclick="App.completeExercise(100)"
                                    class="px-12 py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold rounded-xl hover:shadow-lg transition">
                                    Continuer
                                </button>
                            `}
                        </div>
                    </div>
                `;
            },

            renderColorReflexGame() {
                if (!this.gameState) {
                    const colors = ['Rouge', 'Bleu', 'Vert', 'Jaune'];
                    const colorClasses = {
                        'Rouge': 'text-red-600',
                        'Bleu': 'text-blue-600',
                        'Vert': 'text-green-600',
                        'Jaune': 'text-yellow-600'
                    };
                    
                    const word = colors[Math.floor(Math.random() * colors.length)];
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    
                    this.gameState = {
                        word,
                        color,
                        colors,
                        colorClasses,
                        score: 0,
                        questions: 0,
                        startTime: Date.now()
                    };
                }

                return `
                    <div class="min-h-screen p-6 flex items-center justify-center">
                        <div class="bg-white rounded-3xl p-8 max-w-2xl w-full text-center">
                            <h2 class="text-3xl font-bold text-gray-800 mb-4 title-font">Couleurs Rapides</h2>
                            <div class="text-xl font-bold text-purple-600 mb-6">Score: ${this.gameState.score} / ${this.gameState.questions}</div>
                            
                            ${this.gameState.questions < 10 ? `
                                <p class="text-gray-600 mb-6">Quelle est la COULEUR du texte (pas le mot) ?</p>
                                <div class="text-8xl font-bold mb-12 ${this.gameState.colorClasses[this.gameState.color]}">
                                    ${this.gameState.word}
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    ${this.gameState.colors.map(c => `
                                        <button onclick="App.checkColorAnswer('${c}')"
                                            class="py-6 text-2xl font-bold rounded-2xl transition ${
                                                c === 'Rouge' ? 'bg-red-100 hover:bg-red-200 text-red-700' :
                                                c === 'Bleu' ? 'bg-blue-100 hover:bg-blue-200 text-blue-700' :
                                                c === 'Vert' ? 'bg-green-100 hover:bg-green-200 text-green-700' :
                                                'bg-yellow-100 hover:bg-yellow-200 text-yellow-700'
                                            }">
                                            ${c}
                                        </button>
                                    `).join('')}
                                </div>
                            ` : `
                                <div class="text-4xl font-bold text-green-600 mb-4">Termin√© !</div>
                                <p class="text-2xl text-gray-700 mb-6">Score final: ${this.gameState.score} / 10</p>
                                <button onclick="App.completeExercise(${this.gameState.score * 10})"
                                    class="px-12 py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold rounded-xl hover:shadow-lg transition">
                                    Continuer
                                </button>
                            `}
                        </div>
                    </div>
                `;
            },

            startExercise(idx) {
                this.currentExercise = { ...this.dailyProgram.sequence[idx], index: idx };
                this.gameState = null;
                this.currentPage = 'exercise';
                this.render();
            },

            flipCard(idx) {
                if (this.gameState.flipped.length === 2) return;
                if (this.gameState.flipped.includes(idx) || this.gameState.matched.includes(idx)) return;
                
                this.gameState.flipped.push(idx);
                
                if (this.gameState.flipped.length === 2) {
                    const [first, second] = this.gameState.flipped;
                    if (this.gameState.cards[first] === this.gameState.cards[second]) {
                        this.gameState.matched.push(first, second);
                        this.gameState.flipped = [];
                    } else {
                        setTimeout(() => {
                            this.gameState.flipped = [];
                            this.render();
                        }, 1000);
                    }
                }
                this.render();
            },

            checkMathAnswer() {
                const input = document.getElementById('mathAnswer');
                const answer = parseInt(input.value);
                
                if (answer === this.gameState.answer) {
                    this.gameState.score++;
                }
                
                this.gameState.questions++;
                
                if (this.gameState.questions < 10) {
                    const maxNum = this.gameState.maxNum;
                    let operator = this.gameState.gameData.operator;
                    
                    if (operator === 'mixed') {
                        operator = ['+', '-', '√ó'][Math.floor(Math.random() * 3)];
                    }
                    
                    const num1 = Math.floor(Math.random() * maxNum) + 1;
                    const num2 = Math.floor(Math.random() * maxNum) + 1;
                    
                    this.gameState.operator = operator;
                    this.gameState.num1 = operator === '-' ? Math.max(num1, num2) : num1;
                    this.gameState.num2 = operator === '-' ? Math.min(num1, num2) : num2;
                    
                    if (operator === '+') this.gameState.answer = this.gameState.num1 + this.gameState.num2;
                    else if (operator === '-') this.gameState.answer = this.gameState.num1 - this.gameState.num2;
                    else this.gameState.answer = this.gameState.num1 * this.gameState.num2;
                }
                
                this.render();
            },

            checkSequenceAnswer() {
                const input = document.getElementById('sequenceAnswer');
                const answer = parseInt(input.value);
                
                if (answer === this.gameState.current.answer) {
                    this.gameState.score++;
                }
                
                this.gameState.questions++;
                
                if (this.gameState.questions < 5) {
                    const remaining = this.gameState.allSequences.filter(s => 
                        s.answer !== this.gameState.current.answer
                    );
                    this.gameState.current = remaining[Math.floor(Math.random() * remaining.length)];
                }
                
                this.render();
            },

            checkPatternAnswer(selected) {
                if (selected === this.gameState.current.answer) {
                    this.gameState.score++;
                }
                
                this.gameState.questions++;
                
                if (this.gameState.questions < 5) {
                    const remaining = this.gameState.allPatterns.filter(p => 
                        p.answer !== this.gameState.current.answer
                    );
                    this.gameState.current = remaining[Math.floor(Math.random() * remaining.length)];
                }
                
                this.render();
            },

            checkAnagramAnswer() {
                const input = document.getElementById('anagramAnswer');
                const answer = input.value.toUpperCase();
                
                if (answer === this.gameState.current.word) {
                    this.gameState.score++;
                }
                
                this.gameState.questions++;
                
                if (this.gameState.questions < 5) {
                    const remaining = this.gameState.allWords.filter(w => 
                        w.word !== this.gameState.current.word
                    );
                    this.gameState.current = remaining[Math.floor(Math.random() * remaining.length)];
                }
                
                this.render();
            },

            handleReflexClick() {
                if (this.gameState.waiting) return;
                
                const reactionTime = Date.now() - this.gameState.startTime;
                this.gameState.score.push(reactionTime);
                this.gameState.round++;
                
                if (this.gameState.round < 5) {
                    this.gameState.waiting = true;
                    this.gameState.startTime = null;
                    this.render();
                    
                    setTimeout(() => {
                        this.gameState.waiting = false;
                        this.gameState.startTime = Date.now();
                        this.render();
                    }, Math.random() * 3000 + 1000);
                } else {
                    this.render();
                }
            },

            checkColorAnswer(selected) {
                if (selected === this.gameState.color) {
                    this.gameState.score++;
                }
                
                this.gameState.questions++;
                
                if (this.gameState.questions < 10) {
                    const word = this.gameState.colors[Math.floor(Math.random() * this.gameState.colors.length)];
                    const color = this.gameState.colors[Math.floor(Math.random() * this.gameState.colors.length)];
                    
                    this.gameState.word = word;
                    this.gameState.color = color;
                    this.gameState.startTime = Date.now();
                }
                
                this.render();
            },

            async handleLogin() {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const errorDiv = document.getElementById('error');
                
                if (!email || !password) {
                    errorDiv.textContent = 'Veuillez remplir tous les champs';
                    errorDiv.classList.remove('hidden');
                    return;
                }

                try {
                    const key = `user_${email.replace(/[@.]/g, '_')}`;
                    const credsData = localStorage.getItem(`${key}_credentials`);
                    
                    if (!credsData) {
                        errorDiv.textContent = 'Compte introuvable';
                        errorDiv.classList.remove('hidden');
                        return;
                    }

                    const data = JSON.parse(credsData);
                    if (data.password !== password) {
                        errorDiv.textContent = 'Mot de passe incorrect';
                        errorDiv.classList.remove('hidden');
                        return;
                    }

                    localStorage.setItem('current_session', JSON.stringify({ email }));
                    this.currentUser = email;
                    this.isLoggedIn = true;
                    await this.loadUserData(email);
                    this.currentPage = 'dashboard';
                    this.render();
                } catch (e) {
                    errorDiv.textContent = 'Erreur de connexion';
                    errorDiv.classList.remove('hidden');
                }
            },

            async handleRegister() {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const confirm = document.getElementById('confirm').value;
                const errorDiv = document.getElementById('error');
                
                if (!email || !password || !confirm) {
                    errorDiv.textContent = 'Veuillez remplir tous les champs';
                    errorDiv.classList.remove('hidden');
                    return;
                }

                if (password.length < 6) {
                    errorDiv.textContent = 'Mot de passe trop court (min 6 caract√®res)';
                    errorDiv.classList.remove('hidden');
                    return;
                }

                if (password !== confirm) {
                    errorDiv.textContent = 'Les mots de passe ne correspondent pas';
                    errorDiv.classList.remove('hidden');
                    return;
                }

                try {
                    const key = `user_${email.replace(/[@.]/g, '_')}`;
                    
                    // V√©rifier si le compte existe d√©j√†
                    const existing = localStorage.getItem(`${key}_credentials`);
                    
                    if (existing) {
                        errorDiv.textContent = 'Ce compte existe d√©j√†';
                        errorDiv.classList.remove('hidden');
                        return;
                    }

                    // Cr√©er le compte
                    localStorage.setItem(`${key}_credentials`, JSON.stringify({ email, password }));
                    localStorage.setItem('current_session', JSON.stringify({ email }));
                    
                    this.currentUser = email;
                    this.isLoggedIn = true;
                    this.currentPage = 'onboarding';
                    this.render();
                } catch (e) {
                    console.error('Erreur cr√©ation compte:', e);
                    errorDiv.textContent = 'Erreur lors de la cr√©ation du compte: ' + e.message;
                    errorDiv.classList.remove('hidden');
                }
            },

            handleOnboarding() {
                const name = document.getElementById('name').value;
                const age = document.getElementById('age').value;
                const gender = document.getElementById('gender').value;
                
                if (!name || !age || !gender) {
                    alert('Veuillez remplir tous les champs');
                    return;
                }

                this.userProfile = { name, age, gender, objectives: ['M√©moire', '√ânergie'] };
                this.stats = { xp: 0, streak: 0, coins: 500 }; // Donner 500 pi√®ces de d√©part pour tester
                this.generateProgram(this.userProfile);
                this.saveData();
                this.currentPage = 'dashboard';
                this.render();
            },

            async handleNotificationChange(value) {
                if (!this.settings) {
                    this.settings = { notifications: false, notificationTime: '09:00' };
                }
                
                if (value === 'never') {
                    // D√©sactiver les notifications
                    this.settings.notifications = false;
                } else {
                    // Activer les notifications avec l'heure choisie
                    this.settings.notificationTime = value;
                    
                    if ('Notification' in window) {
                        const permission = await Notification.requestPermission();
                        if (permission !== 'granted') {
                            this.settings.notifications = false;
                            alert('Les notifications ont √©t√© refus√©es. Active-les dans les param√®tres de ton navigateur pour recevoir des rappels.');
                            // Remettre le select sur "Jamais"
                            this.render();
                            return;
                        } else {
                            this.settings.notifications = true;
                            // Envoyer une notification de test
                            new Notification('NeuroFit - Notifications activ√©es ! üéâ', {
                                body: 'Tu recevras un rappel quotidien √† ' + this.settings.notificationTime,
                                icon: 'üß†'
                            });
                        }
                    } else {
                        this.settings.notifications = false;
                        alert('Ton navigateur ne supporte pas les notifications.');
                        this.render();
                        return;
                    }
                }
                
                this.saveData();
                this.render();
            },

            attachEvents() {
                // Attacher l'√©v√©nement au menu d√©roulant de notifications
                const notifSelect = document.getElementById('notificationSelect');
                if (notifSelect) {
                    notifSelect.addEventListener('change', (e) => {
                        App.handleNotificationChange(e.target.value);
                    });
                }
            }
        };

        // Initialiser l'application au chargement de la page
        App.init();
    </script>
</body>
</html>
